<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet">
</head>
<body class="grey-bg">
    <%- include('nav.ejs') %>

    <input class="search">    
    <button class="search-send">ê²€ìƒ‰</button>

    <script>
        document.querySelector('.search-send').addEventListener('click', function(){
            let ì…ë ¥í•œê±° = document.querySelector('.search').value;// input ì— ì…ë ¥í•œê°’
            location.href = '/search?val='+ ì…ë ¥í•œê±°
        })
    </script>

    <% for (var i =0; i< ê¸€ëª©ë¡.length; i++){ %>
        <div class="white-bg">
            <div class="list-box">
                <h4>
                    <%= ìœ ì €._id %> <%= ê¸€ëª©ë¡[i].user %> 
                    <a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>"><%= ê¸€ëª©ë¡[i].title %></a>
                    <% if(String(ê¸€ëª©ë¡[i].user) == String(ìœ ì €._id)) {%>
                        <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                    <% } %>
                    <span class="delete" data-id="<%= ê¸€ëª©ë¡[i]._id %>">ğŸ—‘ï¸</span>
                </h4>
                <p><%= ê¸€ëª©ë¡[i].content %></p>
            </div>
        </div> 
    <% } %>

    <a href="/list/next/<%= ê¸€ëª©ë¡[ê¸€ëª©ë¡.length-1]._id %>">ë‹¤ìŒ</a>
    
    <script>
        // console.log('<%= ê¸€ëª©ë¡.length %>')
        for(let i= 0; i<'<%= ê¸€ëª©ë¡.length  %>';i++){
            document.querySelectorAll('.delete')[i]
            .addEventListener('click', function(e){
                // console.log('e.target.dataset.id',e.target.dataset)
                // ì„œë²„ ì‚­ì œìš”ì²­
                fetch('/delete?docid=' + e.target.dataset.id, {
                    method : 'DELETE'                        
                })
                // .then((r)=>{
                //     if(r.status == 200){
                //         return r.json()
                //     }else{
                //         //ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œ ì „ì†¡ì‹œ ì‹¤í–‰í•  ì½”ë“œ
                //     }
                // })
                .then((r)=> r.text())  // ì™œ ê´„í˜¸ê°€ ì—†ì§€?
                .then((result)=>{
                    //ì„±ê³µì‹œ ì‹¤í–‰í•  ì½”ë“œ
                    // console.log(result)
                    //ì‚­ì œì™„ë£Œì‹œ ìƒìœ„ ìš”ì†Œ ì•ˆë³´ì´ê²Œ í•˜ê¸°
                    e.target.parentElement.parentElement.style.display = 'none'
                })
                .catch((error)=>{
                    //ì¸í„°ë„·ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í•  ì½”ë“œ
                    console.log(error)
                })
                
            })
        }
    </script>
  
  </body>
</html>